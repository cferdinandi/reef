/*! reef v11.BETA | (c) 2021 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef */
function e(e){return(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body")}function t(t,n){function o(e,t){let n=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:"))||(!!e.startsWith("on")||void 0)}function i(e){let t=e.attributes;for(let{name:n,value:i}of t)o(n,i)&&e.removeAttribute(n)}let r=e(t);return function(e){let t=e.querySelectorAll("script");for(let e of t)e.remove()}(r),function e(t){let n=t.children;for(let t of n)i(t),e(t)}(r),n?r:r.innerHTML}function n(e){return["false","null","undefined","0","-0","NaN","0n","-0n"].includes(e)}function o(e){return function(){let t=this,n=arguments;t._debounce&&window.cancelAnimationFrame(t._debounce),t._debounce=window.requestAnimationFrame((function(){e.apply(t,n)}))}}function i(e){return e.props.map((function(e){return e.$}))}function r(e,t={},n=document){if(!e)return;let o=new CustomEvent("reef:"+e,{bubbles:!0,cancelable:!0,detail:t});return n.dispatchEvent(o)}function u(e){for(let t of e.fns)t.run()}function f(e,t){return"object"==typeof e&&(e=new Proxy(e,function e(t){return{get:function(n,o){return"object"==typeof n[o]?new Proxy(n[o],e(t)):n[o]},set:function(e,n,o){return e[n]===o||(e[n]=o,u(t)),!0},deleteProperty:function(e,n){return delete e[n],u(t),!0}}}(t))),e}function l(e){e=f(e,this),Object.defineProperties(this,{$:{get:function(){return e},set:function(t){return e=f(t,this),u(this),!0}},fns:{value:[]}}),r("store",this.$)}let s=!1;function c(e){s=!!e}function d(e){s&&console.warn("[Reef] "+e)}function h(e){let t=e.fns.indexOf(this);t<0||e.fns.splice(t,1)}function a(e,t){return(e="string"==typeof e?document.querySelector(e):e)?t?(Object.defineProperties(this,{el:{value:"string"==typeof e?document.querySelector(e):e},fn:{value:t},props:{value:[]}}),void(this._debounce=null)):d("Please provide a function"):d("Element not found.")}function p(e,t){function n(e,t){a.call(this,e,t)}return n.prototype=Object.create(a.prototype),n}a.prototype.store=function(...e){for(let t of e)this.props.includes(t)||(this.props.push(t),t.fns.push(this))},a.prototype.rm=function(...e){for(let t of e){let e=this.props.indexOf(t);e<0||(this.props.splice(e,1),h(t))}},a.prototype.stop=function(){for(let e of this.props)h(e)},a.prototype.start=function(){for(let e of this.props)e.fns.includes(this)||e.fns.push(this)};let m=p();function b(e,t){return new m(e,t)}m.prototype.run=o((function(){let e=i(this);r("text-before",e,this.el)&&(this.el.textContent=this.fn(...e),r("text",e,this.el))}));let y=p();function v(e,t){return new y(e,t)}y.prototype.run=o((function(){let e=i(this);r("html-before",e,this.el)&&(this.el.innerHTML=t(this.fn(...e)),r("html",e,this.el))}));let g=p();function N(e,t){return new g(e,t)}g.prototype.run=o((function(){let e=i(this);r("html-unsafe-before",e,this.el)&&(this.el.innerHTML=this.fn(...e),r("html-unsafe",e,this.el))}));let w=["input","option","textarea"],x=["value","checked","selected"],C=["checked","selected"];function T(e,t,n){x.includes(t)&&(e[t]="value"===t?n:" "),e.setAttribute(t,n)}function A(e,t){x.includes(t)&&(e[t]=""),e.removeAttribute(t)}function L(e){if(1===e.nodeType){for(let{name:t,value:o}of e.attributes){if("reef-"!==t.slice(0,5))continue;let i=t.replace("reef-default-","").replace("reef-","");A(e,t),C.includes(i)&&n(o)||T(e,i,o)}if(e.childNodes)for(let t of e.childNodes)L(t)}}function P(e){return e.childNodes&&e.childNodes.length?null:e.textContent}function j(e,t){return e.nodeType!==t.nodeType||e.tagName!==t.tagName||e.id!==t.id||e.src!==t.src}function O(e,t){let o=e.childNodes,i=t.childNodes;o.forEach((function(e,o){if(!i[o])return L(e),void t.append(e.cloneNode(!0));if(j(e,i[o])){let t=function(e,t,n){return Array.from(t).slice(n+1).find((function(t){return!j(e,t)}))}(e,i,o);if(!t)return L(e),void i[o].before(e.cloneNode(!0));i[o].before(t)}let r=P(e);if(r&&r!==P(i[o])&&(i[o].textContent=r),function(e,t){if(1!==e.nodeType)return;let o=e.attributes,i=t.attributes;for(let{name:i,value:r}of o){if("reef-default-"===i.slice(0,13))continue;if(x.includes(i)&&w.includes(e.tagName.toLowerCase()))continue;let o=i.replace("reef-","");C.includes(o)&&n(r)?A(t,o):T(t,o,r)}for(let{name:e,value:n}of i)o[e]||x.includes(e)&&w.includes(t.tagName.toLowerCase())||A(t,e)}(e,i[o]),e.childNodes.length||!i[o].childNodes.length){if(!i[o].childNodes.length&&e.childNodes.length){let t=document.createDocumentFragment();return O(e,t),void i[o].appendChild(t)}e.childNodes.length&&O(e,i[o])}else i[o].innerHTML=""})),function(e,t){let n=e.length-t.length;if(!(n<1))for(;n>0;n--)e[e.length-1].remove()}(i,o)}let E=p();function M(e,t){return new E(e,t)}E.prototype.run=o((function(){let e=i(this);r("diff-before",e,this.el)&&(O(t(this.fn(...e),!0),this.el),r("diff",e,this.el))}));let q=p();function F(e,t){return new q(e,t)}q.prototype.run=o((function(){let t=i(this);r("diff-unsafe-before",t,this.el)&&(O(e(this.fn(...t)),this.el),r("diff-unsafe",t,this.el))}));export{l as Store,c as debug,M as diff,F as diffUnsafe,v as html,N as htmlUnsafe,b as text};
