/*! reef v11.BETA | (c) 2021 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef */
"use strict";function e(e){return(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body")}function t(t,n){function o(e,t){let n=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:"))||(!!e.startsWith("on")||void 0)}function r(e){let t=e.attributes;for(let{name:n,value:r}of t)o(n,r)&&e.removeAttribute(n)}let i=e(t);return function(e){let t=e.querySelectorAll("script");for(let e of t)e.remove()}(i),function e(t){let n=t.children;for(let t of n)r(t),e(t)}(i),n?i:i.innerHTML}function n(e){return["false","null","undefined","0","-0","NaN","0n","-0n"].includes(e)}function o(e){return function(){let t=this,n=arguments;t._debounce&&window.cancelAnimationFrame(t._debounce),t._debounce=window.requestAnimationFrame((function(){e.apply(t,n)}))}}function r(e){return e.$.map((function(e){return e.$}))}function i(e,t={},n=document){if(!e)return;let o=new CustomEvent("reef:"+e,{bubbles:!0,cancelable:!0,detail:t});return n.dispatchEvent(o)}Object.defineProperty(exports,"__esModule",{value:!0});let u=!1;function l(e){u&&console.warn("[Reef] "+e)}function f(e){for(let t of e._fns)t.run()}function s(e,t,n){return n||"object"!=typeof e||(e=new Proxy(e,function e(t){return{get:function(n,o){return"object"==typeof n[o]?new Proxy(n[o],e(t)):n[o]},set:function(e,n,o){return e[n]===o||(e[n]=o,f(t)),!0},deleteProperty:function(e,n){return delete e[n],f(t),!0}}}(t))),e}function c(e,t){e=s(e,this,t),Object.defineProperties(this,{$:{get:function(){return t?function e(t){let n=Object.prototype.toString.call(t).slice(8,-1).toLowerCase();return"object"===n?function(){let n={};for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=e(t[o]));return n}():"array"===n?t.map((function(t){return e(t)})):t}(e):e},set:function(n){return t||(e=s(n,this),f(this)),!0}},do:{value:function(t,...n){return this._setters?this._setters[t]?(this._setters[t](e,...n),void f(this)):l(`There is no setter named "${t}"`):l("No setters for this store.")}},_fns:{value:[]},_setters:{value:t}}),i("store",this.$)}function d(e,t){return(e="string"==typeof e?document.querySelector(e):e)?t?(Object.defineProperties(this,{el:{value:"string"==typeof e?document.querySelector(e):e},fn:{value:t},$:{value:[]}}),void(this._debounce=null)):l("Please provide a function"):l("Element not found.")}function a(){function e(e,t){d.call(this,e,t)}return e.prototype=Object.create(d.prototype),e}d.prototype.use=function(...e){for(let t of e)this.$.includes(t)||(this.$.push(t),t._fns.push(this))},d.prototype.destroy=function(){if(i("destroy-before",this)){for(let e of this.$){let t=e._fns.indexOf(this);t<0||e._fns.splice(t,1)}i("destroy",this)}};let h=a();h.prototype.run=o((function(){let e=r(this);i("text-before",e,this.el)&&(this.el.textContent=this.fn(...e),i("text",e,this.el))}));let p=a();p.prototype.run=o((function(){let e=r(this);i("html-before",e,this.el)&&(this.el.innerHTML=t(this.fn(...e)),i("html",e,this.el))}));let m=a();m.prototype.run=o((function(){let e=r(this);i("html-unsafe-before",e,this.el)&&(this.el.innerHTML=this.fn(...e),i("html-unsafe",e,this.el))}));let b=["input","option","textarea"],y=["value","checked","selected"],v=["checked","selected"];function g(e,t,n){y.includes(t)&&(e[t]="value"===t?n:" "),e.setAttribute(t,n)}function w(e,t){y.includes(t)&&(e[t]=""),e.removeAttribute(t)}function x(e){if(1===e.nodeType){for(let{name:t,value:o}of e.attributes){if("reef-"!==t.slice(0,5))continue;let r=t.replace("reef-default-","").replace("reef-","");w(e,t),v.includes(r)&&n(o)||g(e,r,o)}if(e.childNodes)for(let t of e.childNodes)x(t)}}function N(e){return e.childNodes&&e.childNodes.length?null:e.textContent}function _(e,t){return e.nodeType!==t.nodeType||e.tagName!==t.tagName||e.id!==t.id||e.src!==t.src}function j(e,t){let o=e.childNodes,r=t.childNodes;o.forEach((function(e,o){if(!r[o])return x(e),void t.append(e.cloneNode(!0));if(_(e,r[o])){let t=function(e,t,n){return Array.from(t).slice(n+1).find((function(t){return!_(e,t)}))}(e,r,o);if(!t)return x(e),void r[o].before(e.cloneNode(!0));r[o].before(t)}let i=N(e);if(i&&i!==N(r[o])&&(r[o].textContent=i),function(e,t){if(1!==e.nodeType)return;let o=e.attributes,r=t.attributes;for(let{name:r,value:i}of o){if("reef-default-"===r.slice(0,13))continue;if(y.includes(r)&&b.includes(e.tagName.toLowerCase()))continue;let o=r.replace("reef-","");v.includes(o)&&n(i)?w(t,o):g(t,o,i)}for(let{name:e,value:n}of r)o[e]||y.includes(e)&&b.includes(t.tagName.toLowerCase())||w(t,e)}(e,r[o]),e.childNodes.length||!r[o].childNodes.length){if(!r[o].childNodes.length&&e.childNodes.length){let t=document.createDocumentFragment();return j(e,t),void r[o].appendChild(t)}e.childNodes.length&&j(e,r[o])}else r[o].innerHTML=""})),function(e,t){let n=e.length-t.length;if(!(n<1))for(;n>0;n--)e[e.length-1].remove()}(r,o)}let C=a();C.prototype.run=o((function(){let e=r(this);i("diff-before",e,this.el)&&(j(t(this.fn(...e),!0),this.el),i("diff",e,this.el))}));let O=a();O.prototype.run=o((function(){let t=r(this);i("diff-unsafe-before",t,this.el)&&(j(e(this.fn(...t)),this.el),i("diff-unsafe",t,this.el))})),exports.debug=function(e){u=!!e},exports.diff=function(e,t){return new C(e,t)},exports.diffUnsafe=function(e,t){return new O(e,t)},exports.html=function(e,t){return new p(e,t)},exports.htmlUnsafe=function(e,t){return new m(e,t)},exports.store=function(e,t){return new c(e,t)},exports.text=function(e,t){return new h(e,t)};
