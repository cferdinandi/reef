/*! Reef v7.6.2 | (c) 2020 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef */
"use strict";var e=!1,t=function(){if(!window.DOMParser)return!1;var e=new DOMParser;try{e.parseFromString("x","text/html")}catch(e){return!1}return!0}(),n=function(e){return Array.prototype.slice.call(e)},r=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},a=function(t){if(e)throw new Error(t)},o=function(e,t){var n=r(e);if("object"===n){var a={};for(var i in e)e.hasOwnProperty(i)&&(a[i]=o(e[i],t));return a}return"array"===n?e.map((function(e){return o(e,t)})):"string"!==n||t?e:e.replace(/[^\w-_. ]/gi,(function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/javascript:/gi,"")},i=function(e){e.debounce&&window.cancelAnimationFrame(e.debounce),e.debounce=window.requestAnimationFrame((function(){e.render()}))},c=function(e){return{get:function(t,n){return["object","array"].indexOf(r(t[n]))>-1?new Proxy(t[n],c(e)):t[n]},set:function(t,n,r){return t[n]===r||(t[n]=r,i(e)),!0}}},u=function(e,t){var n=e.filter(t);return n.length<1?null:n[0]},l=["checked","selected","value"],s=function(e,t){t.forEach((function(t){e.style[t]=""}))},d=function(e,t){t.forEach((function(t){if("class"===t.att)e.className=t.value;else if("style"===t.att)!function(e,t){var n=function(e){return e.split(";").reduce((function(e,t){var n=t.indexOf(":");return n&&e.push({name:t.slice(0,n).trim(),value:t.slice(n+1).trim()}),e}),[])}(t),r=Array.prototype.filter.call(e.style,(function(t){return null===u(n,(function(n){return n.name===t&&n.value===e.style[t]}))}));s(e,r),function(e,t){t.forEach((function(t){e.style[t.name]=t.value}))}(e,n)}(e,t.value);else{if(t.att in e)try{e[t.att]=t.value,e[t.att]||0===e[t.att]||(e[t.att]=!0)}catch(e){}try{e.setAttribute(t.att,t.value)}catch(e){}}}))},f=function(e,t){t.forEach((function(t){if("class"===t.att)e.className="";else if("style"===t.att)s(e,n(e.style));else{if(t.att in e)try{e[t.att]=""}catch(e){}try{e.removeAttribute(t.att)}catch(e){}}}))},h=function(e,t){return{att:e,value:t}},m=function(e,t){if(1!==e.nodeType)return[];var n=function(e,t){return Array.prototype.reduce.call(e.attributes,(function(e,n){return!(l.indexOf(n.name)<0||t&&"selected"===n.name)||n.name.length>7&&"default"===n.name.slice(0,7)||e.push(h(n.name,n.value)),e}),[])}(e,t);return function(e,t,n){l.forEach((function(r){!e[r]&&0!==e[r]||n&&"option"===e.tagName.toLowerCase()&&"selected"===r||n&&"select"===e.tagName.toLowerCase()&&"value"===r||t.push(h(r,e[r]))}))}(e,n,t),n},p=function(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()},v=function(e){return e.childNodes&&e.childNodes.length>0?null:e.textContent},y=function(e){1===e.nodeType&&(Array.prototype.forEach.call(e.attributes,(function(t){t.name.length<8||"default"!==t.name.slice(0,7)||(d(e,[h(t.name.slice(7).toLowerCase(),t.value)]),f(e,[h(t.name,t.value)]))})),e.childNodes&&Array.prototype.forEach.call(e.childNodes,(function(e){y(e)})))},g=function(e,t,r){var a=n(t.childNodes),o=n(e.childNodes),i=a.length-o.length;if(i>0)for(;i>0;i--)a[a.length-i].parentNode.removeChild(a[a.length-i]);o.forEach((function(e,n){if(!a[n])return y(e),void t.appendChild(e.cloneNode(!0));if(p(e)===p(a[n])){if(function(e,t){var n=m(e,!0),r=m(t),a=r.filter((function(e){return!(l.indexOf(e.att)>-1)&&null===u(n,(function(t){return e.att===t.att}))})),o=n.filter((function(e){var t=u(r,(function(t){return e.att===t.att}));return null===t||t.value!==e.value}));d(t,o),f(t,a)}(e,a[n]),!(r.filter((function(t){return 3!==e.nodeType&&function(e,t){return Element.prototype.matches&&e.matches(t)||Element.prototype.msMatchesSelector&&e.msMatchesSelector(t)||Element.prototype.webkitMatchesSelector&&e.webkitMatchesSelector(t)}(e,t)})).length>0)){var o=v(e);if(o&&o!==v(a[n])&&(a[n].textContent=o),a[n].childNodes.length>0&&e.childNodes.length<1)a[n].innerHTML="";else{if(a[n].childNodes.length<1&&e.childNodes.length>0){var i=document.createDocumentFragment();return g(e,i,r),void a[n].appendChild(i)}e.childNodes.length>0&&g(e,a[n],r)}}}else a[n].parentNode.replaceChild(e.cloneNode(!0),a[n])}))},w=function(e,t){e&&e.forEach((function(e){if(e.attached.indexOf(t)>-1)return a(t.elem+" has attached nodes that it is also attached to, creating an infinite loop.");"render"in e&&e.render()}))},b=function(e,t){if(!(e||t&&t.lagoon))return a("You did not provide an element to make into a component.");if(!t||!t.template&&!t.lagoon)return a("You did not provide a template for this component.");var u=this,l=function(e,t){return e.setters?e.store?null:e.data:e.data&&!e.store?new Proxy(e.data,c(t)):null}(t,u),s=t.store,d=t.router,f=t.setters,h=t.getters;(u.debounce=null,Object.defineProperties(u,{elem:{value:e},template:{value:t.template},allowHTML:{value:t.allowHTML},lagoon:{value:t.lagoon},store:{value:s},attached:{value:[]},router:{value:d}}),Object.defineProperty(u,"data",{get:function(){return f?o(l,!0):l},set:function(e){return s||f||(l=new Proxy(e,c(u)),i(u)),!0}}),f&&!s&&Object.defineProperty(u,"do",{value:function(e){if(!f[e])return a("There is no setter with this name.");var t=n(arguments);t[0]=l,f[e].apply(u,t),i(u)}}),h&&!s&&Object.defineProperty(u,"get",{value:function(e){return h[e]?h[e](l):a("There is no getter with this name.")}}),d&&"addComponent"in d&&d.addComponent(u),s&&"attach"in s&&s.attach(u),t.attachTo)&&("array"===r(t.attachTo)?t.attachTo:[t.attachTo]).forEach((function(e){"attach"in e&&e.attach(u)}))};b.Store=function(e){return e.lagoon=!0,new b(null,e)},b.emit=function(e,t,n){var r;if(!e||!t)return a("You did not provide an element or event name.");r=new CustomEvent(t,{bubbles:!0,detail:n}),e.dispatchEvent(r)},b.prototype.render=function(){if(this.lagoon)w(this.attached,this);else{if(!this.template)return a("No template was provided.");var e="string"===r(this.elem)?document.querySelector(this.elem):this.elem;if(!e)return a("The DOM element to render your template into was not found.");var i=o((this.store?this.store.data:this.data)||{},this.allowHTML),c="function"===r(this.template)?this.template(i,this.router?this.router.current:e,e):this.template;if(!(["string","number"].indexOf(r(c))<0)){var u=this.attached.map((function(e){return e.elem}));return g(function(e){if(t){var r=(new DOMParser).parseFromString(e,"text/html");return r.head&&r.head.childNodes&&r.head.childNodes.length>0&&n(r.head.childNodes).reverse().forEach((function(e){r.body.insertBefore(e,r.body.firstChild)})),r.body||document.createElement("body")}var a=document.createElement("div");return a.innerHTML=e,a}(c),e,u),b.emit(e,"render",i),w(this.attached,this),e}}},b.prototype.attach=function(e){"array"===r(e)?this.attached.concat(e):this.attached.push(e)},b.prototype.detach=function(e){var t="array"===r(e)?e:[e],n=this;t.forEach((function(e){var t=n.attached.indexOf(e);t<0||n.attached.splice(t,1)}))},b.debug=function(t){e=!!t},b.clone=o,b._={trueTypeOf:r,err:a},module.exports=b;
